# 地图图标大小调整指南

## 📏 图标大小说明

### 问题：之前的图标太大

**30px 图标在缩放级别 18 时**：
- 覆盖约 **5 平方米** 的实际地面面积
- 遮挡了周围的地理信息
- 难以精确选择位置

### 解决方案：优化后的图标大小

| 标记类型 | 大小 | 实际覆盖面积（缩放18） | 用途 |
|---------|------|---------------------|------|
| 🔵 **航点 (W)** | 14px | ~0.5m 直径 | 选定的目标位置 |
| 🟠 **无人机 (✈)** | 18px | ~0.7m 直径 | 实时跟踪位置 |
| 🔴 **围栏点** | 12px | ~0.4m 直径 | 地理围栏边界 |
| 🟡 **目标 GPS (L)** | 20px | ~0.8m 直径 | 检测到的目标 |
| 🟢 **精确目标 (P)** | 20px | ~0.8m 直径 | 高精度目标 |

### 大小对比

```
之前 (30px):    ████████  覆盖 ~5m² (一间小房间)
现在 (14px):    ███       覆盖 ~0.5m² (合理大小)
```

## 🔍 缩放级别与实际大小关系

在不同缩放级别下，像素代表的实际距离：

| 缩放级别 | 1 像素 ≈ 实际距离 | 14px 图标 ≈ |
|---------|----------------|------------|
| 15 | ~4.8m | 67m 直径 |
| 16 | ~2.4m | 34m 直径 |
| 17 | ~1.2m | 17m 直径 |
| **18** | ~0.6m | **8.4m 直径** ← 推荐 |
| 19 | ~0.3m | 4.2m 直径 |
| 20 | ~0.15m | 2.1m 直径 |

**推荐缩放级别**：18（默认）
- 清晰可见图标
- 不遮挡周围地理信息
- 适合精确导航

## 🎨 图标设计原则

### 可见性
- ✅ 在卫星地图上清晰可见
- ✅ 不同颜色容易区分
- ✅ 图标符号含义明确

### 精确度
- ✅ 不遮挡周围地理特征
- ✅ 可以精确点击
- ✅ 不干扰其他标记

### 性能
- ✅ SVG/HTML 元素，渲染快速
- ✅ 大小适中，不占用过多内存
- ✅ 更新流畅（10 Hz节流）

## 🛠️ 自定义图标大小

如果需要调整图标大小，编辑 `src/GeofenceHumanPanel.tsx`：

### 调整航点图标（蓝色 W）

```typescript
// 第 203-208 行
const icon = L.divIcon({
  className: "waypoint-marker",
  html: `<div style="background-color: #0000ff; width: 14px; height: 14px; ...">W</div>`,
  iconSize: [14, 14],  // ← 修改这里
  iconAnchor: [7, 7],  // ← 应为 size/2
});
```

### 调整无人机图标（橙色 ✈）

```typescript
// 第 375-380 行
const droneIcon = L.divIcon({
  className: "drone-marker",
  html: `<div style="background-color: #ff6600; width: 18px; height: 18px; ...">✈</div>`,
  iconSize: [18, 18],  // ← 修改这里
  iconAnchor: [9, 9],  // ← 应为 size/2
});
```

### 重要提示

⚠️ **iconAnchor 必须是 iconSize 的一半**
- 确保图标中心对准实际位置
- 错误的 anchor 会导致位置偏移

⚠️ **HTML 样式中的 width/height 必须匹配 iconSize**
- 保持一致性
- 避免渲染问题

## 📍 缩放按钮位置

### 为什么看不到缩放按钮？

**原因**：扩展未重新加载

**解决方法**：

1. **在 Foxglove Studio 中**：
   - 右上角 Extensions 图标
   - 找到 "Geofence & Human GPS Visualizer"
   - 点击 **Uninstall**

2. **关闭并重新打开 Foxglove Studio**

3. **重新导入扩展**：
   - Extensions → **Import extension**
   - 选择：`operator/geofence-human-visualizer/dist/extension.js`

4. **添加面板**

### 缩放按钮应该在哪里？

**位置**：面板右上角

```
┌─────────────────────────────────────────────────┐
│ Geofence... + Waypoint Selector  [✈ Drone] [📍] │ ← 这里
├─────────────────────────────────────────────────┤
│ Status: ...                                      │
│ 📍 Selected Waypoint: ...                       │
│ Click map to select waypoint                    │
├─────────────────────────────────────────────────┤
│                                                  │
│                   [地图区域]                      │
│                                                  │
└─────────────────────────────────────────────────┘
```

### 两个缩放按钮

1. **✈ Drone** (橙色边框)
   - 始终可用
   - 点击后缩放到无人机位置（级别 18）

2. **📍 Waypoint** (蓝色边框)
   - 选择航点后可用
   - 未选择时灰色禁用
   - 点击后缩放到选定航点（级别 18）

## 🧪 测试验证

### 1. 图标大小测试

在缩放级别 18：
```bash
# 1. 加载地图面板
# 2. 点击地图选择航点
# 3. 检查蓝色 W 标记大小

预期：
- 标记清晰可见
- 不遮挡周围建筑物
- 约 0.5m 直径的圆圈
```

### 2. 缩放按钮测试

```bash
# 1. 查看面板右上角
# 2. 应该看到两个按钮：✈ Drone 和 📍 Waypoint

✅ 正确：
- 两个按钮并排显示
- ✈ Drone 橙色边框
- 📍 Waypoint 蓝色边框（灰色如未选择）

❌ 错误：
- 看不到按钮 → 需要重新加载扩展
- 按钮位置错误 → 检查代码
```

### 3. 功能测试

```bash
# 测试 ✈ Drone 按钮
1. 确保无人机在线（发布GPS话题）
2. 点击 "✈ Drone" 按钮
3. 地图应该移动到无人机位置并缩放到级别 18

# 测试 📍 Waypoint 按钮
1. 在地图上点击选择航点
2. "📍 Waypoint" 按钮变为可用（蓝色）
3. 点击按钮
4. 地图应该移动到航点位置并缩放到级别 18
```

## 📊 推荐设置总结

| 项目 | 推荐值 | 说明 |
|------|--------|------|
| 航点图标 | 14px | 精确但可见 |
| 无人机图标 | 18px | 稍大便于跟踪 |
| 默认缩放级别 | 18 | 平衡可见性和细节 |
| 更新频率 | 10 Hz | 流畅且性能好 |
| 位置阈值 | 0.0000001° | ~1cm 精度 |

## 🔧 常见调整

### 需要更小的图标？

```typescript
// 航点 10px (适合缩放级别 19-20)
width: 10px; height: 10px;
iconSize: [10, 10];
iconAnchor: [5, 5];
```

### 需要更大的图标？

```typescript
// 航点 20px (适合缩放级别 16-17)
width: 20px; height: 20px;
iconSize: [20, 20];
iconAnchor: [10, 10];
```

### 需要改变颜色？

```typescript
// 航点改为红色
background-color: #ff0000;
border: "1px solid #ff0000"  // 按钮边框同步
```

## ✅ 检查清单

重新加载扩展后，验证以下内容：

- [ ] 看到卫星地图背景
- [ ] 右上角有两个缩放按钮（✈ Drone 和 📍 Waypoint）
- [ ] 点击地图后出现小的蓝色 W 标记（14px）
- [ ] 无人机位置显示橙色 ✈ 标记（18px）
- [ ] 标记不会遮挡周围地理特征
- [ ] 点击缩放按钮地图立即响应
- [ ] 地图拖动流畅无延迟

全部完成 ✅ → 扩展工作正常！

## 📞 故障排除

### Q: 图标仍然太大？

1. 确认已重新构建：`npm run build`
2. 确认已重新加载扩展到 Foxglove
3. 检查代码中的 `width` 和 `iconSize` 值

### Q: 缩放按钮仍然看不到？

1. **检查浏览器控制台** (F12) 查看错误
2. **完全卸载并重新安装扩展**
3. **清除浏览器缓存**并重启 Foxglove
4. **检查代码**：确认第 488-522 行的按钮代码存在

### Q: 按钮显示但点击无效？

1. 检查浏览器控制台错误
2. 确认 `zoomToDrone` 和 `zoomToWaypoint` 函数已定义
3. 检查无人机位置是否可用（话题是否发布）

---

**最新版本特性**：
- ✅ 优化图标大小（14-18px）
- ✅ 性能优化（10 Hz 更新）
- ✅ 缩放按钮（右上角）
- ✅ 卫星地图背景
- ✅ 流畅的交互体验

重新加载扩展即可体验所有新功能！🎉




